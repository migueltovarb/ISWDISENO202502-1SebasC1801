<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veterinaria AnimalCare - Sistema de Gestión</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header" id="mainHeader" style="display: none;">
        <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <img src="/images/Logo.png" alt="VETERINARIA ANIMALCARE" class="logo-image">
                    </div>
                </div>
                <nav class="nav" id="mainNav">
                    <a href="#inicio" class="nav-link active">
                        <i class="fas fa-home"></i> Inicio
                    </a>
                    <a href="#registro" class="nav-link">
                        <i class="fas fa-plus-circle"></i> Registro
                    </a>
                    <a href="#registros" class="nav-link">
                        <i class="fas fa-list"></i> Registros
                    </a>
                    <a href="#citas-medicas" class="nav-link">
                        <i class="fas fa-calendar-check"></i> Citas Médicas
                    </a>
                </nav>
                
                <!-- Menú hamburguesa para móvil -->
                <button class="mobile-menu-toggle" id="mobileMenuToggle" onclick="toggleMobileMenu()">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                
                <div class="user-actions">
                    <button onclick="logout()" class="btn btn-logout-header" title="Cerrar Sesión">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
    </header>

    <!-- Sistema de Autenticación -->
    <div id="authContainer" class="auth-container">
        <div class="auth-wrapper">
            <!-- Login Form -->
            <div id="loginForm" class="auth-form">
                <div class="auth-header">
                    <div class="auth-logo">
                        <div class="logo-icon">
                            <img src="/images/Logo.png" alt="VETERINARIA ANIMALCARE" class="logo-image">
                        </div>
                    </div>
                    <div style="display:flex; align-items:center; justify-content:center; width:100%">
                        <div style="text-align:center; width:100%">
                            <h2>Iniciar Sesión</h2>
                            <p>Accede a tu cuenta veterinaria</p>
                        </div>
                        <!-- Botón de modo oscuro eliminado temporalmente -->
                    </div>
                </div>
                
                <form id="loginFormElement" class="auth-form-element" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label class="form-label" for="loginEmail">Correo Electrónico</label>
                        <input type="email" class="form-control" id="loginEmail" name="email" 
                               placeholder="tu@email.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="loginPassword">Contraseña</label>
                        <input type="password" class="form-control" id="loginPassword" name="password" 
                               placeholder="Tu contraseña" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="loginRole">Tipo de Usuario</label>
                        <select class="form-control form-select" id="loginRole" name="role" required>
                            <option value="">Selecciona tu rol</option>
                            <option value="user">Usuario</option>
                            <option value="veterinarian">Veterinario</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-lg auth-btn">
                        <i class="fas fa-sign-in-alt"></i>
                        Iniciar Sesión
                    </button>
                    
                    <div class="auth-switch">
                        <p>¿No tienes cuenta? <a href="#" onclick="showRegisterForm()">Regístrate aquí</a></p>
                    </div>
                </form>
            </div>
        
            <!-- Register Form -->
            <div id="registerForm" class="auth-form" style="display: none;">
                <div class="auth-header">
                    <div class="auth-logo">
                        <div class="logo-icon">
                            <img src="/images/Logo.png" alt="VETERINARIA ANIMALCARE" class="logo-image">
                        </div>
                    </div>
                    <h2>Crear Cuenta</h2>
                    <p>Regístrate en el sistema veterinario</p>
                </div>
            
            <form id="registerFormElement" class="auth-form-element" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label class="form-label" for="registerName">Nombre Completo *</label>
                    <input type="text" class="form-control" id="registerName" name="name" 
                           placeholder="Ej: Juan Pérez" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="registerEmail">Correo Electrónico *</label>
                    <input type="email" class="form-control" id="registerEmail" name="email" 
                           placeholder="tu@email.com" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="registerPassword">Contraseña *</label>
                    <input type="password" class="form-control" id="registerPassword" name="password" 
                           placeholder="Mínimo 6 caracteres" required minlength="6">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="registerConfirmPassword">Confirmar Contraseña *</label>
                    <input type="password" class="form-control" id="registerConfirmPassword" name="confirmPassword" 
                           placeholder="Repite tu contraseña" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="registerRole">Tipo de Usuario *</label>
                    <select class="form-control form-select" id="registerRole" name="role" required>
                        <option value="">Selecciona tu rol</option>
                        <option value="user">Usuario</option>
                        <option value="veterinarian">Veterinario</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="registerPhone">Teléfono *</label>
                    <input type="tel" class="form-control" id="registerPhone" name="phone" 
                           placeholder="Ej: +57 300 123 4567" required>
                </div>
                
                <button type="submit" class="btn btn-primary btn-lg auth-btn">
                    <i class="fas fa-user-plus"></i>
                    Crear Cuenta
                </button>
                
                <div class="auth-switch">
                    <p>¿Ya tienes cuenta? <a href="#" onclick="showLoginForm()">Inicia sesión aquí</a></p>
                </div>
            </form>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main" id="mainContent" style="display: none;">
        <!-- Inicio Section -->
            <section id="inicio" class="section active">
                <!-- Banner Section -->
                <div class="banner-section">
                    <img src="/images/banner.png" alt="Veterinaria AnimalCare" class="banner-image">
                    <div class="banner-overlay">
                        <h1 class="banner-title">¡Tu mascota merece el mejor cuidado!</h1>
                        <p class="banner-subtitle">Sistema de gestión veterinaria para la materia de diseño de software</p>
                        
                        <!-- User Info in Banner -->
                        <div class="banner-user-info" id="userInfo">
                            <div class="banner-user-welcome">
                                <div class="banner-user-avatar">
                                    <i class="fas fa-user-circle"></i>
                                </div>
                                <div class="banner-user-details">
                                    <h3><span id="userName"></span></h3>
                                    <p class="banner-user-role"><span id="userRole"></span></p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Elegant Banner Decoration -->
                        <div class="banner-decoration">
                            <div class="decoration-line"></div>
                            <div class="decoration-icon">
                                <i class="fas fa-paw"></i>
                            </div>
                            <div class="decoration-line"></div>
                        </div>
                    </div>
                </div>

                

                <!-- Description Section -->
                <div class="description-section">
                    <div class="card">
                        <h2 class="description-title">¿Qué puedes hacer en Veterinaria AnimalCare?</h2>
                        <div class="description-content">
                            <p class="description-text">
                                Bienvenido a nuestro sistema de gestión veterinaria integral, pensado para ofrecerte una experiencia completa y eficiente en el cuidado de tus mascotas. Si te interesa alguno de los servicios que te presentaremos a continuación. Por favor da click sobre la descripción y se te llevará a la sección correspondiente.
                            </p>
                            
                            <div class="description-features">
                                <div class="feature-item" onclick="showSection('registro')" style="cursor: pointer;" title="Ir a registro de mascotas">
                                    <div class="feature-icon">
                                        <i class="fas fa-paw"></i>
                                    </div>
                                    <div class="feature-content">
                                        <h3>Registro de Mascotas</h3>
                                        <p>Registra y gestiona el perfil completo de tus mascotas, incluyendo información médica, vacunas, historial clínico y datos del propietario. Mantén un registro detallado y actualizado de cada animal.</p>
                                    </div>
                                </div>
                                
                                <div class="feature-item" onclick="showSection('citas-medicas')" style="cursor: pointer;" title="Gestionar consultas integradas en Citas Médicas">
                                    <div class="feature-icon">
                                        <i class="fas fa-stethoscope"></i>
                                    </div>
                                    <div class="feature-content">
                                        <h3>Consultas Integradas</h3>
                                        <p>Las consultas se gestionan desde Citas Médicas en un flujo unificado con edición y seguimiento.</p>
                                    </div>
                                </div>
                                
                                <div class="feature-item" onclick="showAppointmentsSection()" style="cursor: pointer;" title="Gestionar citas médicas">
                                    <div class="feature-icon">
                                        <i class="fas fa-calendar-check"></i>
                                    </div>
                                    <div class="feature-content">
                                        <h3>Citas Médicas</h3>
                                        <p>Organiza y programa citas médicas con diferentes niveles de prioridad. Los veterinarios pueden gestionar la agenda completa, asignar profesionales y establecer prioridades según la urgencia.</p>
                                    </div>
                                </div>
                                
                                <div class="feature-item" onclick="showUserProfileModal()" style="cursor: pointer;" title="Ver perfil de usuario">
                                    <div class="feature-icon">
                                        <i class="fas fa-users-cog"></i>
                                    </div>
                                    <div class="feature-content">
                                        <h3>Control de Accesos</h3>
                                        <p>Sistema de roles: los veterinarios gestionan citas y consultas; los usuarios registran mascotas y ven su información.</p>
                                    </div>
                                </div>
                                
                                <div class="feature-item" onclick="animateStats()" style="cursor: pointer;" title="Ver estadísticas animadas">
                                    <div class="feature-icon">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <div class="feature-content">
                                        <h3>Estadísticas y Reportes</h3>
                                        <p>Visualiza estadísticas en tiempo real sobre mascotas registradas, citas programadas, consultas realizadas y otros indicadores importantes para el funcionamiento de la clínica.</p>
                                    </div>
                                </div>
                                
                                <div class="feature-item" onclick="showSecurityModal()" style="cursor: pointer;" title="Información de seguridad">
                                    <div class="feature-icon">
                                        <i class="fas fa-shield-alt"></i>
                                    </div>
                                    <div class="feature-content">
                                        <h3>Seguridad y Privacidad</h3>
                                        <p>Protección completa de datos médicos y personales con encriptación segura. Cada usuario solo puede acceder a la información autorizada según su rol en el sistema.</p>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                </div>

            </section>

            <!-- Registro Section -->
            <section id="registro" class="section">
                <div class="card">
                    <div class="card-header" style="position: relative;">
                        <h1 class="card-title">Registro de Nueva Mascota</h1>
                        <p class="card-subtitle">Complete la información paso a paso para registrar una nueva mascota</p>
                        
                        <!-- Botón de navegación independiente -->
                        <div style="position: absolute; top: 15px; right: 20px;">
                            <button onclick="showSection('inicio')" class="btn btn-outline" style="background: rgba(255,255,255,0.9); border: 2px solid #b45309; color: #b45309; font-weight: bold; padding: 8px 16px; transition: all 0.3s ease;">
                                <i class="fas fa-home"></i>
                                Volver al Inicio
                            </button>
                        </div>
                    </div>

                    <form id="registroForm" class="registro-form wizard-form show-all">
                        <!-- Paso 1: Información Básica -->
                        <div class="wizard-content active" data-step="1">
                            <div class="step-header">
                                <h2><i class="fas fa-paw"></i> Información Básica</h2>
                                <p>Comencemos con los datos esenciales de tu mascota</p>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label" for="name">Nombre de la Mascota *</label>
                                    <input type="text" class="form-control" id="name" name="name" 
                                           placeholder="Ej: Max, Luna, Piolín..." required>
                                    <div class="field-help">El nombre que usas para llamar a tu mascota</div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="family_type">Tipo de Familia *</label>
                                    <select class="form-control form-select" id="family_type" name="familyType" required>
                                        <option value="">Seleccione una familia</option>
                                        <option value="domestic">Doméstica</option>
                                        <option value="exotic">Exótica</option>
                                    </select>
                                    <div class="field-help">Doméstica: perros, gatos. Exótica: reptiles, aves exóticas</div>
                                </div>
                            </div>
                        </div>

                        <!-- Paso 2: Detalles del Animal -->
                        <div class="wizard-content" data-step="2">
                            <div class="step-header">
                                <h2><i class="fas fa-info-circle"></i> Detalles del Animal</h2>
                                <p>Información específica sobre la especie y características</p>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label" for="animal_type">Tipo de Animal *</label>
                                    <select class="form-control form-select" id="animal_type" name="animalType" required>
                                        <option value="">Seleccione un tipo</option>
                                        <option value="dog">Perro</option>
                                        <option value="cat">Gato</option>
                                        <option value="bird">Ave</option>
                                        <option value="reptile">Reptil</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="breed">Raza *</label>
                                    <select class="form-control form-select" id="breed" name="breed" required>
                                        <option value="">Selecciona una raza</option>
                                    </select>
                                    <input type="text" class="form-control" id="breed_input" name="breed_input" 
                                           placeholder="Escribe la raza manualmente..." style="display: none;">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="age">Edad (años) *</label>
                                    <input type="number" class="form-control" id="age" name="age" 
                                           min="0" max="30" placeholder="Ej: 3" required>
                                    <div class="field-help">Si no conoces la edad exacta, puedes aproximar</div>
                                </div>
                            </div>


                        </div>

                        <!-- Paso 3: Información del Propietario -->
                        <div class="wizard-content" data-step="3">
                            <div class="step-header">
                                <h2><i class="fas fa-user"></i> Información del Propietario</h2>
                                <p>Datos de contacto del responsable de la mascota</p>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label" for="owner_name">Nombre Completo *</label>
                                    <input type="text" class="form-control" id="owner_name" name="ownerName" 
                                           placeholder="Ej: Juan Pérez García" required>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="owner_phone">Teléfono *</label>
                                    <input type="tel" class="form-control" id="owner_phone" name="ownerPhone" 
                                           placeholder="Ej: +57 300 123 4567" required>
                                    <div class="field-help">Incluye código de país para mejor contacto</div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="owner_email">Email</label>
                                    <input type="email" class="form-control" id="owner_email" name="ownerEmail" 
                                           placeholder="Ej: juan@email.com">
                                    <div class="field-help">Para envío de recordatorios y resultados</div>
                                </div>
                            </div>

                            
                        </div>

                        <!-- Guardado directo -->
                        <div class="wizard-navigation" style="display: none;"></div>

                        <div style="display: flex; justify-content: center; margin-top: 1.5rem;">
                            <button type="button" id="savePetDirectBtn" class="btn btn-success wizard-btn">
                                <i class="fas fa-save"></i>
                                <span class="btn-text">Guardar Mascota</span>
                            </button>
                        </div>

                        <!-- Botones adicionales -->
                        <div class="form-actions" style="margin-top: 2rem; border-top: 1px solid var(--border-color); padding-top: 1rem;">
                            <button type="button" onclick="showSection('registros')" class="btn btn-outline">
                                <i class="fas fa-list"></i>
                                Ver Registros
                            </button>
                            <button type="button" onclick="window.testRegisterPet()" class="btn btn-warning">
                                <i class="fas fa-bug"></i>
                                Test Sistema
                            </button>
                        </div>
                    </form>

                    <!-- Modal de resultado de guardado -->
                    <div id="saveResultModal" class="modal" style="display: none;">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3 id="saveResultTitle">Resultado del guardado</h3>
                                <button class="modal-close" onclick="closeSaveResultModal()"><i class="fas fa-times"></i></button>
                            </div>
                            <div class="modal-body">
                                <p id="saveResultMessage"></p>
                            </div>
                            <div class="modal-actions" style="display: flex; gap: 0.75rem; justify-content: flex-end;">
                                <button id="retrySaveBtn" class="btn btn-primary" style="display: none;">Volver a intentar</button>
                                <button id="closeSaveModalBtn" class="btn btn-outline" onclick="closeSaveResultModal()">Cerrar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Registros Section -->
            <section id="registros" class="section">
                <div class="card">
                    <div class="card-header" style="position: relative;">
                        <h1 class="card-title">Registros de Mascotas</h1>
                        <p class="card-subtitle">Lista de todas las mascotas registradas en el sistema</p>
                        <!-- Barra de búsqueda por nombre -->
                        <div class="searchbar" style="margin-top: 12px; display: flex; gap: 8px; align-items: center;">
                            <input type="text" id="petSearchInput" class="form-control" placeholder="Buscar por nombre de mascota..." oninput="filterPetsByName()" />
                            <button type="button" id="petSearchBtn" class="btn btn-outline" onclick="filterPetsByName()" title="Buscar">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                        
                        <!-- Botón de navegación independiente -->
                        <div style="position: absolute; top: 15px; right: 20px;">
                            <button onclick="showSection('inicio')" class="btn btn-outline" style="background: rgba(255,255,255,0.9); border: 2px solid #b45309; color: #b45309; font-weight: bold; padding: 8px 16px; transition: all 0.3s ease;">
                                <i class="fas fa-home"></i>
                                Volver al Inicio
                            </button>
                        </div>
                    </div>
                    
                    <!-- Botones de navegación -->
                    <div class="form-actions" style="margin-bottom: 20px;">
                        <button onclick="showSection('registro')" class="btn btn-primary btn-lg">
                            <i class="fas fa-plus-circle"></i>
                            Registrar Nueva Mascota
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre</th>
                                    <th>Edad</th>
                                    <th>Raza</th>
                                    <th>Tipo</th>
                                    <th>Familia</th>
                                    <th>Propietario</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="petsTableBody">
                                <!-- Los registros se cargarán dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Citas Médicas Section -->
            <section id="citas-medicas" class="section">
                <div class="card">
                    <div class="card-header" style="position: relative;">
                        <h1 class="card-title">
                            <i class="fas fa-calendar-check"></i>
                            Gestión de Citas Médicas
                        </h1>
                        <p class="card-subtitle">Administra y visualiza todas las citas programadas</p>
                        
                        <!-- Botón de navegación independiente -->
                        <div style="position: absolute; top: 15px; right: 20px;">
                            <button onclick="showSection('inicio')" class="btn btn-outline" style="background: rgba(255,255,255,0.9); border: 2px solid #b45309; color: #b45309; font-weight: bold; padding: 8px 16px; transition: all 0.3s ease;">
                                <i class="fas fa-home"></i>
                                Volver al Inicio
                            </button>
                        </div>
                    </div>
                    
                    <div class="card-body">
                        <!-- Acción principal -->
                        <div class="form-actions" style="margin-bottom: 12px; display: flex; gap: 8px; align-items: center;">
                            <button onclick="scheduleNewAppointment()" class="btn btn-primary btn-lg">
                                <i class="fas fa-calendar-plus"></i>
                                Agendar Cita Médica
                            </button>
                        </div>

                        <!-- Filtros y búsqueda -->
                        <div class="filters-section">
                            <div class="filter-group">
                                <label for="filterStatus">Filtrar por Estado:</label>
                                <select id="filterStatus" class="form-control form-select">
                                    <option value="">Todos los estados</option>
                                    <option value="scheduled">Programadas</option>
                                    <option value="completed">Completadas</option>
                                    <option value="cancelled">Canceladas</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label for="filterVet">Filtrar por Veterinario:</label>
                                <select id="filterVet" class="form-control form-select">
                                    <option value="">Todos los veterinarios</option>
                                    <option value="dr_garcia">Dr. García</option>
                                    <option value="dra_martinez">Dra. Martínez</option>
                                    <option value="dr_rodriguez">Dr. Rodríguez</option>
                                </select>
                            </div>
                            
                            <button onclick="applyFilters()" class="btn btn-primary">
                                <i class="fas fa-filter"></i> Aplicar Filtros
                            </button>
                        </div>
                        
                        
                        
                        <!-- Lista de citas -->
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Mascota</th>
                                        <th>Dueño</th>
                                        <th>Fecha</th>
                                        <th>Hora</th>
                                        <th>Veterinario</th>
                                        <th>Motivo</th>
                                        <th>Prioridad</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="appointmentsTableBody">
                                    <!-- Las citas se cargarán dinámicamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Búsqueda Avanzada Section -->

            
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="text-center">
                <p>&copy; 2025 Veterinaria AnimalCare. Sistema de gestión veterinaria.</p>
            </div>
        </div>
    </footer>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Modal de confirmación de eliminación -->
    <div id="deleteModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-triangle"></i> Confirmar Eliminación</h3>
                <button class="close-btn" onclick="closeDeleteModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p>¿Estás seguro de que quieres eliminar esta mascota?</p>
                <div class="pet-info">
                    <p><strong>Nombre:</strong> <span id="deletePetName"></span></p>
                    <p><strong>Dueño:</strong> <span id="deletePetOwner"></span></p>
                </div>
                <p class="warning-text">Esta acción no se puede deshacer.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeDeleteModal()">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button class="btn btn-danger" onclick="confirmDelete()">
                    <i class="fas fa-trash"></i> Eliminar
                </button>
            </div>
        </div>
    </div>

    <div id="cancelAppointmentModal" class="modal" style="display: none; align-items: center; justify-content: center;">
        <div class="modal-content" style="max-width: 520px; width: 92%;">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-triangle"></i> Confirmar cancelación</h3>
                <button class="close-btn" onclick="closeCancelAppointmentModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p>¿Deseas cancelar esta cita médica y eliminarla de la lista?</p>
                <div class="pet-info">
                    <p><strong>Mascota:</strong> <span id="cancelAppointmentPetName">-</span></p>
                </div>
                <p class="warning-text">Al confirmar, la cita desaparecerá inmediatamente.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeCancelAppointmentModal()">
                    <i class="fas fa-times"></i> Volver
                </button>
                <button class="btn btn-danger" onclick="confirmCancelAppointment()">
                    <i class="fas fa-trash"></i> Cancelar cita médica
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de edición de citas y consultas (pantalla completa, accesible) -->
    <div id="editAppointmentModal" class="modal" style="display: none;" role="dialog" aria-modal="true" aria-labelledby="editAppointmentModalTitle" tabindex="-1">
        <div class="modal-content edit-appointment-modal-content" role="document">
            <div class="modal-header">
                <h3 class="modal-title" id="editAppointmentModalTitle">
                    <i class="fas fa-calendar-edit" aria-hidden="true"></i> Editar Cita / Consulta
                </h3>
                <button class="modal-close" onclick="closeEditAppointmentModal()" aria-label="Cerrar">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="editAppointmentForm" class="edit-appointment-form" novalidate>
                    <div class="form-group">
                        <label class="form-label" for="editAppointmentPet">Mascota *</label>
                        <select class="form-control form-select" id="editAppointmentPet" name="petId" required></select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="editAppointmentOwnerName">Propietario</label>
                        <input type="text" class="form-control" id="editAppointmentOwnerName" name="ownerName" readonly aria-readonly="true">
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="editAppointmentDate">Fecha *</label>
                            <input type="date" class="form-control" id="editAppointmentDate" name="date" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="editAppointmentTime">Hora *</label>
                            <input type="time" class="form-control" id="editAppointmentTime" name="time" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="editAppointmentVeterinarian">Veterinario *</label>
                        <select class="form-control form-select" id="editAppointmentVeterinarian" name="veterinarian" required>
                            <option value="">Selecciona un veterinario</option>
                            <option value="dr_garcia">Dr. García</option>
                            <option value="dra_martinez">Dra. Martínez</option>
                            <option value="dr_rodriguez">Dr. Rodríguez</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="editAppointmentReason">Motivo *</label>
                        <input type="text" class="form-control" id="editAppointmentReason" name="reason" placeholder="Motivo de la consulta..." required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="editAppointmentDescription">Descripción *</label>
                        <textarea class="form-control" id="editAppointmentDescription" name="description" placeholder="Describe los síntomas o detalles relevantes..." rows="4" required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="editAppointmentPriority">Prioridad *</label>
                        <select class="form-control form-select" id="editAppointmentPriority" name="priority" required>
                            <option value="normal">Normal</option>
                            <option value="high">Alta</option>
                            <option value="urgent">Urgente</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="editAppointmentStatus">Estado *</label>
                        <select class="form-control form-select" id="editAppointmentStatus" name="status" required>
                            <option value="scheduled">Pendiente</option>
                            <option value="confirmed">Confirmada</option>
                            <option value="completed">Completada</option>
                            <option value="cancelled">Cancelada</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeEditAppointmentModal()">
                    <i class="fas fa-times" aria-hidden="true"></i> Cancelar
                </button>
                <button type="button" class="btn btn-primary" onclick="saveAppointmentEdit()">
                    <i class="fas fa-save" aria-hidden="true"></i> Guardar Cambios
                </button>
            </div>
        </div>
    </div>

    <style>
        .modal {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.5);
            z-index: 20000;
        }
        .modal.show { display: flex; }
        .modal > .modal-footer { display: none !important; }
        .edit-appointment-modal-content {
            width: 100%;
            max-width: 560px;
            max-height: 88vh;
            background: #ffffff;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.18);
            display: grid;
            grid-template-rows: auto 1fr auto;
            margin: 0;
            overflow: hidden !important;
        }
        .edit-appointment-modal-content .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            background: #FEF3C7;
            border-bottom: 1px solid #FDE68A;
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
        }
        .edit-appointment-modal-content .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #92400E;
        }
        .edit-appointment-modal-content .modal-title i {
            color: #D97706;
            margin-right: 8px;
        }
        .edit-appointment-modal-content .modal-close {
            background: transparent;
            border: none;
            color: #B45309;
            font-size: 1.25rem;
            cursor: pointer;
        }
        .edit-appointment-modal-content .modal-body {
            padding: 18px 20px;
            padding-right: 24px;
            overflow-y: auto;
            scrollbar-gutter: stable both-edges;
            overscroll-behavior: contain;
            padding-bottom: 24px;
            background: #ffffff;
        }
        .edit-appointment-form label {
            font-weight: 600;
            color: #6B7280;
            margin-bottom: 6px;
        }
        .edit-appointment-modal-content .form-section {
            background: #fff;
            border-radius: 12px;
            box-shadow: none;
            border: 1px solid #FDE68A;
            border-left: 4px solid #F59E0B;
            margin-bottom: 16px;
        }
        .edit-appointment-modal-content .form-section:last-child { margin-bottom: 0; }
        .edit-appointment-form select,
        .edit-appointment-form input[type="text"],
        .edit-appointment-form input[type="date"],
        .edit-appointment-form input[type="time"],
        .edit-appointment-form textarea {
            width: 100%;
            border: 2px solid #FECF67;
            border-radius: 10px;
            padding: 10px 12px;
            font-size: 0.95rem;
            outline: none;
            transition: box-shadow .2s ease, border-color .2s ease;
            background: #fff;
        }
        #editAppointmentTime { border-color: #10B981; }
        .edit-appointment-form textarea::placeholder,
        .edit-appointment-form input::placeholder { color: #D97706; opacity: 0.7; }
        .edit-appointment-form select:focus,
        .edit-appointment-form input:focus,
        .edit-appointment-form textarea:focus {
            box-shadow: 0 0 0 3px rgba(254, 215, 135, 0.5);
            border-color: #F59E0B;
        }
        .edit-appointment-modal-content .modal-footer {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 16px 20px;
            background: #FFFAEB;
            border-top: 1px solid #FDE68A;
            border-bottom-left-radius: 16px;
            border-bottom-right-radius: 16px;
            gap: 12px;
            width: 100%;
            box-sizing: border-box;
            margin-top: 0;
        }
        .edit-appointment-modal-content .btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 10px 16px;
            border-radius: 10px;
            font-weight: 700;
        }
        .edit-appointment-modal-content .btn-secondary {
            background: #FEF3C7;
            border: 2px solid #EAB308;
            color: #6B4F1D;
        }
        .edit-appointment-modal-content .btn-primary {
            background: #D4A017;
            border: 2px solid #B08912;
            color: #fff;
        }
        .edit-appointment-modal-content .btn i {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border-radius: 6px;
            background: #FDE68A;
            color: #92400E;
        }
        .edit-appointment-modal-content .btn-primary i { background: #B08912; color: #fff; }
        @media (max-width: 768px) {
            .edit-appointment-modal-content { max-width: 92vw; border-radius: 14px; }
            .edit-appointment-modal-content .modal-body { flex: 1 1 auto; }
        }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        @media (max-width: 640px) { .form-grid { grid-template-columns: 1fr; } }
        .form-section { margin-bottom: 1rem; }
        .form-section-title { margin-bottom: .5rem; }
        .form-readonly-value { padding: .5rem .75rem; background: #f7f7f7; border-radius: 6px; }
    </style>

    <script src="app.js"></script>
</body>
</html>
